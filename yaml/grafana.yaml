---
# Source: grafana/templates/grafana-cofig.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-provisioning
data:
  datasources.yaml: |
    # config file version
    apiVersion: 1
    # list of datasources to insert/update depending
    # what's available in the database
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        orgId: 1
        url: http://monitor:9090
        # <bool> enable/disable basic auth
        basicAuth: false
        # <bool> enable/disable with credentials headers
        withCredentials: false
        # <bool> mark as default datasource. Max one per org
        isDefault: true
        version: 2
        # <bool> allow users to edit datasources from the UI.
        editable: true
  dashboards.yaml: |
    # # config file version
    apiVersion: 1
    providers:
      - name: 'default'
        orgId: 1
        folder: ''
        folderUid: ''
        type: file
        options:
          path: /var/lib/grafana/dashboards
  grafana.ini: |
    ##################### Grafana Configuration Defaults #####################
    #
    # Do not modify this file in grafana installs
    #

    # possible values : production, development
      app_mode = production

      # instance name, defaults to HOSTNAME environment variable value or hostname if HOSTNAME var is empty
      instance_name = ${HOSTNAME}

    #################################### Paths ###############################
      [paths]
    # Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used)
      data = data

      # Temporary files in `data` directory older than given duration will be removed
      temp_data_lifetime = 24h

      # Directory where grafana can store logs
      logs = data/log

      # Directory where grafana will automatically scan and look for plugins
      plugins = data/plugins

      # folder that contains provisioning config files that grafana will apply on startup and while running.
      provisioning = conf/provisioning

    #################################### Server ##############################
      [server]
    # Protocol (http, https, h2, socket)
      protocol = http

      # The ip address to bind to, empty will bind to all interfaces
      http_addr =

      # The http port to use
      http_port = 3000

      # The public facing domain name used to access grafana from a browser
      domain = 192.168.1.2

      # Redirect to correct domain if host header does not match domain
      # Prevents DNS rebinding attacks
      enforce_domain = false

      # The full public facing url
      root_url = %(protocol)s://%(domain)s:%(http_port)s/dts/grafana/

      # Serve Grafana from subpath specified in `root_url` setting. By default it is set to `false` for compatibility reasons.
      serve_from_sub_path = true

      # Log web requests
      router_logging = false

      # the path relative working path
      static_root_path = public

      # enable gzip
      enable_gzip = false

      # https certs & key file
      cert_file =
      cert_key =

      # Unix socket path
      socket = /var/run/grafana.sock

    #################################### Database ############################
      [database]
    # You can configure the database connection by specifying type, host, name, user and password
    # as separate properties or as on string using the url property.

    # Either "mysql", "postgres" or "sqlite3", it's your choice
      type = sqlite3
      host = 127.0.0.1:3306
      name = grafana
      user = root
      # If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;"""
      password =
      # Use either URL or the previous fields to configure the database
      # Example: mysql://user:secret@host:port/database
      url =

      # Max idle conn setting default is 2
      max_idle_conn = 2

      # Max conn setting default is 0 (mean not set)
      max_open_conn =

      # Connection Max Lifetime default is 14400 (means 14400 seconds or 4 hours)
      conn_max_lifetime = 14400

      # Set to true to log the sql calls and execution times.
      log_queries =

      # For "postgres", use either "disable", "require" or "verify-full"
      # For "mysql", use either "true", "false", or "skip-verify".
      ssl_mode = disable

      ca_cert_path =
      client_key_path =
      client_cert_path =
      server_cert_name =

      # For "sqlite3" only, path relative to data_path setting
      path = grafana.db

      # For "sqlite3" only. cache mode setting used for connecting to the database
      cache_mode = private

    #################################### Cache server #############################
      [remote_cache]
    # Either "redis", "memcached" or "database" default is "database"
      type = database

      # cache connectionstring options
      # database: will use Grafana primary database.
      # redis: config like redis server e.g. `addr=127.0.0.1:6379,pool_size=100,db=0,ssl=false`. Only addr is required. ssl may be 'true', 'false', or 'insecure'.
      # memcache: 127.0.0.1:11211
      connstr =

    #################################### Data proxy ###########################
      [dataproxy]

    # This enables data proxy logging, default is false
      logging = false

      # How long the data proxy should wait before timing out default is 30 (seconds)
      timeout = 30

      # If enabled and user is not anonymous, data proxy will add X-Grafana-User header with username into the request, default is false.
      send_user_header = false

    #################################### Analytics ###########################
      [analytics]
    # Server reporting, sends usage counters to stats.grafana.org every 24 hours.
    # No ip addresses are being tracked, only simple counters to track
    # running instances, dashboard and error counts. It is very helpful to us.
    # Change this option to false to disable reporting.
      reporting_enabled = true

      # Set to false to disable all checks to https://grafana.com
      # for new versions (grafana itself and plugins), check is used
      # in some UI views to notify that grafana or plugin update exists
      # This option does not cause any auto updates, nor send any information
      # only a GET request to https://grafana.com to get latest versions
      check_for_updates = true

      # Google Analytics universal tracking code, only enabled if you specify an id here
      google_analytics_ua_id =

      # Google Tag Manager ID, only enabled if you specify an id here
      google_tag_manager_id =

    #################################### Security ############################
      [security]
    # disable creation of admin user on first start of grafana
      disable_initial_admin_creation = false

      # default admin user, created on startup
      admin_user = admin

      # default admin password, can be changed before first start of grafana, or in profile settings
      admin_password = Cljslrl0620

      # used for signing
      secret_key = SW2YcwTIb9zpOOhoPsMm

      # disable gravatar profile images
      disable_gravatar = true

      # data source proxy whitelist (ip_or_domain:port separated by spaces)
      data_source_proxy_whitelist =

      # disable protection against brute force login attempts
      disable_brute_force_login_protection = false

      # set to true if you host Grafana behind HTTPS. default is false.
      cookie_secure = false

      # set cookie SameSite attribute. defaults to `lax`. can be set to "lax", "strict" and "none"
      cookie_samesite = lax

      # set to true if you want to allow browsers to render Grafana in a <frame>, <iframe>, <embed> or <object>. default is false.
      allow_embedding = true

      # Set to true if you want to enable http strict transport security (HSTS) response header.
      # This is only sent when HTTPS is enabled in this configuration.
      # HSTS tells browsers that the site should only be accessed using HTTPS.
      # The default will change to true in the next minor release, 6.3.
      strict_transport_security = false

      # Sets how long a browser should cache HSTS. Only applied if strict_transport_security is enabled.
      strict_transport_security_max_age_seconds = 86400

      # Set to true if to enable HSTS preloading option. Only applied if strict_transport_security is enabled.
      strict_transport_security_preload = false

      # Set to true if to enable the HSTS includeSubDomains option. Only applied if strict_transport_security is enabled.
      strict_transport_security_subdomains = false

      # Set to true to enable the X-Content-Type-Options response header.
      # The X-Content-Type-Options response HTTP header is a marker used by the server to indicate that the MIME types advertised
      # in the Content-Type headers should not be changed and be followed. The default will change to true in the next minor release, 6.3.
      x_content_type_options = false

      # Set to true to enable the X-XSS-Protection header, which tells browsers to stop pages from loading
      # when they detect reflected cross-site scripting (XSS) attacks. The default will change to true in the next minor release, 6.3.
      x_xss_protection = false

    #################################### Dashboards ##################

      [dashboards]
    # Number dashboard versions to keep (per dashboard). Default: 20, Minimum: 1
      versions_to_keep = 20

    #################################### Users ###############################
      [users]
    # disable user signup / registration
      allow_sign_up = true

      # Allow non admin users to create organizations
      allow_org_create = true

      # Set to true to automatically assign new users to the default organization (id 1)
      auto_assign_org = true

      # Set this value to automatically add new users to the provided organization (if auto_assign_org above is set to true)
      auto_assign_org_id = 1

      # Default role new users will be automatically assigned (if auto_assign_org above is set to true)
      auto_assign_org_role = Viewer

      # Require email validation before sign up completes
      verify_email_enabled = false

      # Background text for the user field on the login page
      login_hint = email or username
      password_hint = password

      # Default UI theme ("dark" or "light")
      default_theme = light

      # External user management
      external_manage_link_url =
      external_manage_link_name =
      external_manage_info =

      # Viewers can edit/inspect dashboard settings in the browser. But not save the dashboard.
      viewers_can_edit = false

      # Editors can administrate dashboard, folders and teams they create
      editors_can_admin = false

      [auth]
    # Login cookie name
      login_cookie_name = grafana_session

      # The lifetime (days) an authenticated user can be inactive before being required to login at next visit. Default is 7 days.
      login_maximum_inactive_lifetime_days = 7

      # The maximum lifetime (days) an authenticated user can be logged in since login time before being required to login. Default is 30 days.
      login_maximum_lifetime_days = 30

      # How often should auth tokens be rotated for authenticated users when being active. The default is each 10 minutes.
      token_rotation_interval_minutes = 10

      # Set to true to disable (hide) the login form, useful if you use OAuth
      disable_login_form = false

      # Set to true to disable the signout link in the side menu. useful if you use auth.proxy
      disable_signout_menu = false

      # URL to redirect the user to after sign out
      signout_redirect_url =

      # Set to true to attempt login with OAuth automatically, skipping the login screen.
      # This setting is ignored if multiple OAuth providers are configured.
      oauth_auto_login = false

      # limit of api_key seconds to live before expiration
      api_key_max_seconds_to_live = -1

    #################################### Anonymous Auth ######################
      [auth.anonymous]
    # enable anonymous access
      enabled = true

      # specify organization name that should be used for unauthenticated users
      org_name = Main Org.

      # specify role for unauthenticated users
      org_role = Viewer



    #################################### Basic Auth ##########################
      [auth.basic]
      enabled = true


    #################################### Logging ##########################
      [log]
    # Either "console", "file", "syslog". Default is console and file
    # Use space to separate multiple modes, e.g. "console file"
      mode = console file

      # Either "debug", "info", "warn", "error", "critical", default is "info"
      level = info

      # optional settings to set different levels for specific loggers. Ex filters = sqlstore:debug
      filters =

    # For "console" mode only
      [log.console]
      level =

      # log line format, valid options are text, console and json
      format = console

    # For "file" mode only
      [log.file]
      level =

      # log line format, valid options are text, console and json
      format = text

      # This enables automated log rotate(switch of following options), default is true
      log_rotate = true

      # Max line number of single file, default is 1000000
      max_lines = 1000000

      # Max size shift of single file, default is 28 means 1 << 28, 256MB
      max_size_shift = 28

      # Segment log daily, default is true
      daily_rotate = true

      # Expired days of log file(delete after max days), default is 7
      max_days = 7

      [log.syslog]
      level =

      # log line format, valid options are text, console and json
      format = text

      # Syslog network type and address. This can be udp, tcp, or unix. If left blank, the default unix endpoints will be used.
      network =
      address =

      # Syslog facility. user, daemon and local0 through local7 are valid.
      facility =

      # Syslog tag. By default, the process' argv[0] is used.
      tag =

    #################################### Usage Quotas ########################
      [quota]
      enabled = false

      #### set quotas to -1 to make unlimited. ####
      # limit number of users per Org.
      org_user = 10

      # limit number of dashboards per Org.
      org_dashboard = 100

      # limit number of data_sources per Org.
      org_data_source = 10

      # limit number of api_keys per Org.
      org_api_key = 10

      # limit number of orgs a user can create.
      user_org = 10

      # Global limit of users.
      global_user = -1

      # global limit of orgs.
      global_org = -1

      # global limit of dashboards
      global_dashboard = -1

      # global limit of api_keys
      global_api_key = -1

      # global limit on number of logged in users.
      global_session = -1

    #################################### Alerting ############################
      [alerting]
    # Disable alerting engine & UI features
      enabled = true
      # Makes it possible to turn off alert rule execution but alerting UI is visible
      execute_alerts = true

      # Default setting for new alert rules. Defaults to categorize error and timeouts as alerting. (alerting, keep_state)
      error_or_timeout = alerting

      # Default setting for how Grafana handles nodata or null values in alerting. (alerting, no_data, keep_state, ok)
      nodata_or_nullvalues = no_data

      # Alert notifications can include images, but rendering many images at the same time can overload the server
      # This limit will protect the server from render overloading and make sure notifications are sent out quickly
      concurrent_render_limit = 5

      # Default setting for alert calculation timeout. Default value is 30
      evaluation_timeout_seconds = 30

      # Default setting for alert notification timeout. Default value is 30
      notification_timeout_seconds = 30

      # Default setting for max attempts to sending alert notifications. Default value is 3
      max_attempts = 3


    #################################### Explore #############################
      [explore]
    # Enable the Explore section
      enabled = true

    #################################### Internal Grafana Metrics ############
    # Metrics available at HTTP API Url /metrics
      [metrics]
      enabled              = true
      interval_seconds     = 10
      # Disable total stats (stat_totals_*) metrics to be generated
      disable_total_stats = false

      #If both are set, basic auth will be required for the metrics endpoint.
      basic_auth_username =
      basic_auth_password =

    # Send internal Grafana metrics to graphite
      [metrics.graphite]
    # Enable by setting the address setting (ex localhost:2003)
      address =
      prefix = prod.grafana.%(instance_name)s.

      [grafana_net]
      url = https://grafana.com

      [grafana_com]
      url = https://grafana.com

      [panels]
    # here for to support old env variables, can remove after a few months
      enable_alpha = false
      disable_sanitize_html = false

      [plugins]
      enable_alpha = false
      app_tls_skip_verify_insecure = false

      [feature_toggles]
    # enable features, separated by spaces
      enable =
---
# Source: grafana/templates/grafana-dashboards.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: dts
data:
  dts-full-migration.json: |-
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "grafana",
              "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "target": {
              "limit": 100,
              "matchAny": false,
              "tags": [],
              "type": "dashboard"
            },
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "每秒钟读写行数",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 1,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 0,
            "y": 0
          },
          "id": 2,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "editorMode": "code",
              "expr": "rate(dts_data_row_count{event_type=\"read\", task_id=\"$task_id\"}[5m])",
              "legendFormat": "读取源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_data_row_count{event_type=\"write\", task_id=\"$task_id\"}[5m])",
              "hide": false,
              "legendFormat": "写入目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "RPS",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "每秒钟读写的数据量",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "binBps"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 12,
            "y": 0
          },
          "id": 6,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_data_bytes{event_type=\"read\", task_id=\"$task_id\"}[5m])",
              "legendFormat": "读取源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_data_bytes{event_type=\"write\", task_id=\"$task_id\"}[5m])",
              "hide": false,
              "legendFormat": "写入目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Throughput",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "每秒钟处理的事务数",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 9
          },
          "id": 10,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_data_transaction_count{event_type=\"read\", task_id=\"$task_id\"}[5m])",
              "legendFormat": "读取源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_data_transaction_count{event_type=\"write\", task_id=\"$task_id\"}[5m])",
              "hide": false,
              "legendFormat": "写入目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "TPS",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "数据库响应时间",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "ms"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 9
          },
          "id": 8,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "builder",
              "expr": "dts_data_sql_response_time{event_type=\"read\", task_id=\"$task_id\"}",
              "legendFormat": "源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "builder",
              "expr": "dts_data_sql_response_time{event_type=\"write\", task_id=\"$task_id\"}",
              "hide": false,
              "legendFormat": "目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Database Response Time",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "缓存的行数",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 17
          },
          "id": 12,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "max(dts_data_row_count{event_type=\"read\", task_id=\"$task_id\"}) - min(dts_data_row_count{event_type=\"write\", task_id=\"$task_id\"})",
              "legendFormat": "缓存的行数",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Queued Rows",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "网络延时",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "ms"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 17
          },
          "id": 14,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "builder",
              "expr": "dts_network_delay{end_type=\"source\", task_id=\"$task_id\"}",
              "legendFormat": "源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "builder",
              "expr": "dts_network_delay{end_type=\"target\", task_id=\"$task_id\"}",
              "hide": false,
              "legendFormat": "目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Network Delay",
          "type": "timeseries"
        }
      ],
      "refresh": false,
      "schemaVersion": 37,
      "style": "dark",
      "tags": [],
      "templating": {
        "list": [
          {
            "current": {
              "selected": false,
              "text": "42933b995114",
              "value": "42933b995114"
            },
            "datasource": {
              "type": "prometheus",
              "uid": "PBFA97CFB590B2093"
            },
            "definition": "label_values(task_id)",
            "hide": 2,
            "includeAll": false,
            "label": "task_id",
            "multi": false,
            "name": "task_id",
            "options": [],
            "query": {
              "query": "label_values(task_id)",
              "refId": "StandardVariableQuery"
            },
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 0,
            "type": "query"
          }
        ]
      },
      "time": {
        "from": "now-30m",
        "to": "now"
      },
      "timepicker": {},
      "timezone": "",
      "title": "full migration",
      "uid": "rKMxvp24k",
      "version": 1,
      "weekStart": ""
    }
  dts-sync-migration.json: |-
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "grafana",
              "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "target": {
              "limit": 100,
              "matchAny": false,
              "tags": [],
              "type": "dashboard"
            },
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 0
          },
          "id": 2,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "builder",
              "expr": "dts_binlog_delay{event_type=\"write\", task_id=\"$task_id\"}",
              "legendFormat": "写目标端",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Write Delay(RTO)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 0
          },
          "id": 4,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "builder",
              "expr": "dts_binlog_delay{event_type=\"read\", task_id=\"$task_id\"}",
              "legendFormat": "读取源端",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Read Delay(RPO)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "每秒钟同步的行数",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 8
          },
          "id": 6,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_binlog_row_count{event_type=\"read\", task_id=\"$task_id\"}[30s])",
              "legendFormat": "读取源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_binlog_row_count{event_type=\"write\", task_id=\"$task_id\"}[30s])",
              "hide": false,
              "legendFormat": "写目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "RPS",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "每秒钟同步的数据量",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "binBps"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 8
          },
          "id": 8,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_binlog_bytes{event_type=\"read\", task_id=\"$task_id\"}[30s])",
              "legendFormat": "读取源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_binlog_bytes{event_type=\"write\", task_id=\"$task_id\"}[30s])",
              "hide": false,
              "legendFormat": "写目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Throughput",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "每秒钟处理的事务数",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 16
          },
          "id": 10,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_binlog_transaction_count{event_type=\"read\", task_id=\"$task_id\"}[1m])",
              "legendFormat": "读取源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "rate(dts_binlog_transaction_count{event_type=\"write\", task_id=\"$task_id\"}[1m])",
              "hide": false,
              "legendFormat": "写目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "TPS",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "数据库响应时间",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "ms"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 16
          },
          "id": 12,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "builder",
              "expr": "dts_binlog_sql_response_time{event_type=\"read\", task_id=\"$task_id\"}",
              "legendFormat": "源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "builder",
              "expr": "dts_binlog_sql_response_time{event_type=\"write\", task_id=\"$task_id\"}",
              "hide": false,
              "legendFormat": "目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Database Response Time",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "缓存的行数",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 24
          },
          "id": 14,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "max(dts_binlog_row_count{event_type=\"read\", task_id=\"$task_id\"}) - min(dts_binlog_row_count{event_type=\"write\", task_id=\"$task_id\"}) - min(dts_binlog_row_count{event_type=\"skip\", task_id=\"$task_id\"})",
              "legendFormat": "缓存的行数",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Queued Rows",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PBFA97CFB590B2093"
          },
          "description": "网络延时",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "ms"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 24
          },
          "id": 16,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "dts_network_delay{end_type=\"source\", task_id=\"$task_id\"}",
              "legendFormat": "源端",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus"
              },
              "editorMode": "code",
              "expr": "dts_network_delay{end_type=\"target\", task_id=\"$task_id\"}",
              "hide": false,
              "legendFormat": "目标端",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Network Delay",
          "type": "timeseries"
        }
      ],
      "refresh": false,
      "schemaVersion": 37,
      "style": "dark",
      "tags": [],
      "templating": {
        "list": [
          {
            "current": {
              "selected": false,
              "text": "42933b995114",
              "value": "42933b995114"
            },
            "datasource": {
              "type": "prometheus",
              "uid": "PBFA97CFB590B2093"
            },
            "definition": "label_values(task_id)",
            "hide": 2,
            "includeAll": false,
            "label": "task_id",
            "multi": false,
            "name": "task_id",
            "options": [],
            "query": {
              "query": "label_values(task_id)",
              "refId": "StandardVariableQuery"
            },
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 0,
            "type": "query"
          }
        ]
      },
      "time": {
        "from": "now-30m",
        "to": "now"
      },
      "timepicker": {},
      "timezone": "",
      "title": "sync migration",
      "uid": "x6apn22Vk",
      "version": 1,
      "weekStart": ""
    }
---
# Source: grafana/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: grafana
  namespace: dts
  annotations:
    prometheus.io/scrape: 'true'
  labels:
    app.kubernetes.io/name: grafana
spec:
  selector:
    app.kubernetes.io/name: grafana
  ports:
    - name: grafana
      protocol: TCP
      port: 3000
  type: ClusterIP
---
# Source: grafana/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
  namespace: dts
  labels:
    app.kubernetes.io/name: grafana
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: grafana
  template:
    metadata:
      annotations:
        grafana-version: '1.0'
      name: grafana
      labels:
        app.kubernetes.io/name: grafana
    spec:
      containers:
        - name: grafana
          image: k8smaster.qfusion.irds/irds/grafana:9.2.8
          imagePullPolicy: IfNotPresent
          securityContext:
            runAsUser: 0
          env:
            - name: GF_SECURITY_ADMIN_PASSWORD
              value: admin
            - name: GF_AUTH_ANONYMOUS_ENABLED
              value: "true"
            - name: GF_SECURITY_ALLOW_EMBEDDING
              value: "true"
          ports:
            - name: grafana
              containerPort: 3000
          resources:
            {}
          volumeMounts:
            - name: grafana-provisioning
              mountPath: /etc/grafana/provisioning/datasources/datasources.yaml
              subPath: datasources.yaml
            - name: grafana-provisioning
              mountPath: /etc/grafana/provisioning/dashboards/dashboards.yaml
              subPath: dashboards.yaml
            - name: grafana-dashboards
              mountPath: /var/lib/grafana/dashboards/
            - name: grafana-provisioning
              mountPath: /etc/grafana/grafana.ini
              subPath: grafana.ini
            
      volumes:
        - name: grafana-dashboards
          configMap:
            name: grafana-dashboards
        - name: grafana-provisioning
          configMap:
            name: grafana-provisioning
        
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - dts-grafana
              topologyKey: kubernetes.io/hostname
            weight: 1
      tolerations: 
        - effect: NoSchedule
          key: node-role.kubernetes.io/master
          operator: Exists
